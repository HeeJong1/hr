<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <link rel="stylesheet" href="/css/layout.css">
    <style>
        .profileCard {
            background-color: #f5f5f5;
            border-radius: clamp(8px, 2vw, 12px);
            padding: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: clamp(1rem, 3vw, 1.5rem);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .profileCard h3 {
            color: #333;
            margin-bottom: clamp(1rem, 2vw, 1.5rem);
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }

        .profileInfo {
            display: flex;
            flex-direction: column;
            gap: clamp(1rem, 2vw, 1.5rem);
        }

        .infoRow {
            display: flex;
            align-items: center;
            padding: clamp(0.75rem, 2vw, 1rem);
            background-color: white;
            border-radius: clamp(6px, 1vw, 8px);
            border-left: 4px solid #3498db;
        }

        .infoLabel {
            color: #7f8c8d;
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: 600;
            min-width: clamp(80px, 20vw, 120px);
        }

        .infoValue {
            color: #2c3e50;
            font-size: clamp(0.95rem, 2vw, 1.1rem);
        }

        .passwordChange {
            margin-top: clamp(1.5rem, 3vw, 2rem);
        }

        .formGroup {
            display: flex;
            flex-direction: column;
            margin-bottom: clamp(1rem, 2vw, 1.5rem);
        }

        .formGroup label {
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
            font-size: clamp(0.9rem, 2vw, 1rem);
        }

        .formGroup input {
            padding: clamp(0.75rem, 2vw, 1rem);
            border: 2px solid #ddd;
            border-radius: clamp(4px, 1vw, 6px);
            font-size: clamp(0.9rem, 2vw, 1rem);
            background-color: white;
            transition: border-color 0.3s ease;
        }

        .formGroup input:focus {
            outline: none;
            border-color: #3498db;
        }

        .btnChangePassword {
            padding: clamp(0.875rem, 2vw, 1rem);
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: clamp(6px, 1vw, 8px);
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btnChangePassword:hover {
            background-color: #2980b9;
        }

        .message {
            padding: clamp(0.75rem, 2vw, 1rem);
            border-radius: clamp(6px, 1vw, 8px);
            margin-bottom: clamp(1rem, 2vw, 1.5rem);
            font-size: clamp(0.85rem, 2vw, 0.95rem);
            display: none;
        }

        .message.error {
            background-color: #ffe6e6;
            color: #d32f2f;
            border: 1px solid #ffcccc;
        }

        .message.success {
            background-color: #e6f7e6;
            color: #2e7d32;
            border: 1px solid #ccf0cc;
        }
    </style>
</head>

<body>
    <section class="layoutSection">
        <!-- ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ -->
        <button class="menuToggle" onclick="toggleSidebar()">â˜°</button>

        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebarHeader">
                <h2>HR ì‹œìŠ¤í…œ</h2>
            </div>
            <nav class="sidebarMenu">
                <a href="/home" class="menuItem">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
                <a href="/notice" class="menuItem">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
                <a href="/leave" class="menuItem">ğŸ“… ì—°ì°¨ê´€ë¦¬</a>
                <a href="/leaveCalendar" class="menuItem">ğŸ—“ï¸ íœ´ê°€ìº˜ë¦°ë”</a>
                <a href="/attendance" class="menuItem">â° ì¶œí‡´ê·¼</a>
                <a href="/salary" class="menuItem">ğŸ’° ê¸‰ì—¬ê´€ë¦¬</a>
                <a href="/employee" class="menuItem">ğŸ‘¥ ì§ì›ê´€ë¦¬</a>
                <a href="/admin/leave" class="menuItem bossOnly">âš™ï¸ ì—°ì°¨ìŠ¹ì¸</a>
            </nav>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="mainContent">
            <!-- í—¤ë” -->
            <header class="header">
                <h1>ë§ˆì´í˜ì´ì§€</h1>
                <div class="userInfo">
                    <a href="/mypage" style="color: #555; text-decoration: none; font-size: clamp(0.9rem, 2vw, 1rem);">
                        <span id="userName">ì‚¬ìš©ì</span>
                    </a>
                    <button class="btnLogout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <!-- ì»¨í…ì¸  -->
            <main class="content">
                <!-- ì—°ì°¨ í˜„í™© -->
                <div class="profileCard">
                    <h3>ë‚´ ì—°ì°¨ í˜„í™©</h3>
                    <div class="profileInfo"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <div class="infoRow" style="flex-direction: column; align-items: flex-start;">
                            <span class="infoLabel">ì´ ì—°ì°¨</span>
                            <span class="infoValue" id="totalDays"
                                style="font-size: clamp(1.3rem, 3vw, 1.5rem); color: #3498db;">-</span>
                        </div>
                        <div class="infoRow" style="flex-direction: column; align-items: flex-start;">
                            <span class="infoLabel">ì‚¬ìš©í•œ ì—°ì°¨</span>
                            <span class="infoValue" id="usedDays"
                                style="font-size: clamp(1.3rem, 3vw, 1.5rem); color: #e74c3c;">-</span>
                        </div>
                        <div class="infoRow" style="flex-direction: column; align-items: flex-start;">
                            <span class="infoLabel">ë‚¨ì€ ì—°ì°¨</span>
                            <span class="infoValue" id="remainingDays"
                                style="font-size: clamp(1.3rem, 3vw, 1.5rem); color: #27ae60;">-</span>
                        </div>
                    </div>
                </div>

                <!-- í”„ë¡œí•„ ì •ë³´ -->
                <div class="profileCard">
                    <h3>ë‚´ ì •ë³´</h3>
                    <div class="profileInfo">
                        <div class="infoRow">
                            <span class="infoLabel">ì•„ì´ë””</span>
                            <span class="infoValue" id="userId">-</span>
                        </div>
                        <div class="infoRow">
                            <span class="infoLabel">ì´ë¦„</span>
                            <span class="infoValue" id="userNameInfo">-</span>
                        </div>
                        <div class="infoRow">
                            <span class="infoLabel">ì´ë©”ì¼</span>
                            <span class="infoValue" id="userEmail">-</span>
                        </div>
                        <div class="infoRow">
                            <span class="infoLabel">ì§ê¸‰</span>
                            <span class="infoValue" id="userRole">-</span>
                        </div>
                    </div>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
                <div class="profileCard">
                    <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                    <div id="message" class="message"></div>
                    <form id="passwordChangeForm" class="passwordChange">
                        <div class="formGroup">
                            <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="currentPassword" required placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="formGroup">
                            <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="newPassword" required placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="formGroup">
                            <label for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input type="password" id="confirmPassword" required placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <button type="submit" class="btnChangePassword">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    </form>
                </div>
            </main>

            <!-- í‘¸í„° -->
            <footer class="footer">
                <div class="footerContent">
                    <div>
                        <strong>HR Management System</strong>
                        <p>ì¸ì‚¬ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                    </div>
                </div>
                <div class="copyright">
                    Â© 2024 HR Management System. All rights reserved.
                </div>
            </footer>
        </div>
    </section>

    <script>
        // ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('memberNo');
                localStorage.removeItem('userId');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('userName');
                localStorage.removeItem('userRole');
                alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/login';
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');

            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login';
                return;
            }

            // localStorageì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const userId = localStorage.getItem('userId') || '-';
            const userEmail = localStorage.getItem('userEmail') || '-';
            const userName = localStorage.getItem('userName') || 'ì‚¬ìš©ì';
            const userRole = localStorage.getItem('userRole') || 'ROLE_USER';
            const memberNo = localStorage.getItem('memberNo');

            document.getElementById('userName').textContent = userName;
            document.getElementById('userNameInfo').textContent = userName;
            document.getElementById('userId').textContent = userId;
            document.getElementById('userEmail').textContent = userEmail;

            // ì§ê¸‰ í‘œì‹œ
            let roleText = 'USER';
            if (userRole === 'ROLE_BOSS') {
                roleText = 'BOSS';
                // BOSSì¼ ê²½ìš° ê´€ë¦¬ì ë©”ë‰´ í‘œì‹œ
                document.querySelectorAll('.bossOnly').forEach(item => {
                    item.classList.add('show');
                });
            }
            document.getElementById('userRole').textContent = roleText;

            // ì—°ì°¨ ì •ë³´ ë¡œë“œ
            if (memberNo) {
                await loadLeaveInfo(memberNo);
            }
        });

        // ì—°ì°¨ ì •ë³´ ë¡œë“œ
        async function loadLeaveInfo(memberNo) {
            try {
                const response = await fetch(`/api/leave/member/${memberNo}`);
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('totalDays').textContent = data.totalDays + 'ì¼';
                    document.getElementById('usedDays').textContent = data.usedDays + 'ì¼';
                    document.getElementById('remainingDays').textContent = data.remainingDays + 'ì¼';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼
        document.getElementById('passwordChangeForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            if (newPassword !== confirmPassword) {
                showMessage('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                // TODO: API êµ¬í˜„
                showMessage('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'error');
            } catch (error) {
                showMessage('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('Error:', error);
            }
        });
    </script>
</body>

</html>